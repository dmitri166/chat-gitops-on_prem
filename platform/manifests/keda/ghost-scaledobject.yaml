# KEDA Autoscaling Configuration
apiVersion: keda.sh/v1alpha1
kind: ScaledObject
metadata:
  name: ghost-http-scaledobject
  namespace: ghost
  labels:
    app.kubernetes.io/name: ghost
    app.kubernetes.io/component: autoscaling
spec:
  scaleTargetRef:
    name: ghost-deployment
    kind: Deployment
  minReplicaCount: 1
  maxReplicaCount: 10
  triggers:
    - type: http
      metadata:
        name: ghost-requests-trigger
      spec:
        targetAverageValue: "100"
        scaleTargetRef:
          name: ghost-deployment
          kind: Deployment
        hosts:
          - ghost-dev.local
          - ghost-staging.local
          - ghost-prod.local
        metricType: Value
        window: 2m
    - type: cpu
      metadata:
        name: ghost-cpu-trigger
      spec:
        metricType: Resource
        metadata:
          name: ghost-deployment
        value: "70"
        scaleTargetRef:
          name: ghost-deployment
          kind: Deployment
        window: 2m
    - type: memory
      metadata:
        name: ghost-memory-trigger
      spec:
        metricType: Resource
        metadata:
          name: ghost-deployment
        value: "512Mi"
        scaleTargetRef:
          name: ghost-deployment
          kind: Deployment
        window: 2m
